Using the Towny API in your plugins is quite simple. There are two versions of the API.
<ol>
<li>The original API which ran from version 0 to 0.94.0.0</li>
<li>The new API which is present in Towny 0.94.0.1 and onwards.</li>
</ol>
The new API supports the old API calls although they will appear as deprecated. It is recommended that authors do switch the new API.

<h2>Getting started with Towny and your IDE</h2>
For the moment Towny doesn't use Maven, so there is no Maven repo to add Towny with.
This means (for the time being - mavenization is happening,) that you will add the Towny.jar as an External Jar.

Once it is added you can put Towny into your plugin.yml's depend or softdepend list (depending on whether your plugin needs Towny present to function all of the time, or if you want to support Towny features when present.)

Lastly you will need to add the following to your pre's import section:
<pre>import com.palmergames.bukkit.towny.TownyAPI;</pre>

<h2>Common API uses</h2>

<h3>Checking if a player is in the wilderness</h3>
To check if the player is in the wilderness is easy:
<pre>if (TownyAPI.getInstance().isWilderness(player.getLocation()))
    return false;
</pre>
Any location is accepted.

<h3>Checking if a player is in their own town.</h3>
To find the town a player is standing in, you have to look at the TownBlock, which is what towns are made up of.
Looking up a TownBlock from a player's location can return null if the player is standing in the wilderness, so it is recommended that you perform an isWilderness(Location loc) test [seen directly above on this page] before you look up the TownBlock.
<pre>try {
	Town town = TownyAPI.getInstance().getTownBlock(player.getLocation()).getTown();
	if (resident.getTown().equals(town)) {
	//Execute your code here
	}
} catch (NotRegisteredException e) {
	//Code put here can also be code that ought to be run if the player is in the wilderness and not a town.
	e.printStackTrace();

}
</pre>

The above code will require the following imports:
<pre>import com.palmergames.bukkit.towny.object.Resident;
import com.palmergames.bukkit.towny.object.Town;
import com.palmergames.bukkit.towny.exceptions.NotRegisteredException;
</pre>

You've probably want to know how to get the resident so that you can use the above code, so here it is:

<h3>Getting a Resident from a player</h3>
Most of the time getting the resident object of a player is something you'll need quite often.
Here is how you do it:

<pre>import com.palmergames.bukkit.towny.object.Resident;

Resident resident = TownyAPI.getInstance().getDataSource().getResident(player.getName());
</pre>

<h3>Getting a Town</h3>
Getting a town can be much like what you've seen already:
<pre>
import com.palmergames.bukkit.towny.object.Town;

//When you've already got a resident.
if (resident.hasTown())
    Town town = TownyAPI.getInstance().getDataSource().getTown(resident.getTown()); 

//When you've already got a townblock.
if (townblock.hasTown())
   Town town = TownyAPI.getInstance().getDataSource().getTown(townblock.getTown());
</pre>
You can skip the .hasTown() checks if you want to surround your code with a Try/Catch block.


<h3>Getting a Nation</h3>
Getting a town can be much like what you've seen already:
<pre>
import com.palmergames.bukkit.towny.object.Nation;

//When you've already got a town.
if (town.hasNation())
    Nation nation = TownyAPI.getInstance().getDataSource().getNation(town.getNation()); 
//When you've already got a resident.
if (resident.hasTown() && resident.getTown().hasNation())
    Nation nation = TownyAPI.getInstance().getDataSource().getNation(resident.getTown().getNation());
</pre>
You can skip the .hasNation() checks if you want to surround your code with a Try/Catch block.

<h3>Checking if Towny would prevent PVP damage</h3>
A common use of the API in magic/combat/rpg plugins is needing to know if Towny would prevent PVP combat.

This is simple using our CombatUtil:

While using Bukkit's EntityDamageByEntityEvent doing the following:
<pre>
import com.palmergames.bukkit.towny.utils.CombatUtil;

private Towny towny = (Towny) Bukkit.getServer().getPluginManager().getPlugin("Towny");

@EventHandler(priority = EventPriority.LOWEST)
private void playerPVPEvent (EntityDamageByEntityEvent event) { 
    Entity attacker = event.getDamager();
    Entity defender = event.getEntity();
    
    if (CombatUtil.preventDamageCall(towny, attacker, defender))
        return;
}
</pre>
The preventDamageCall will return True if Towny would stop the damage from happening.

<h3>Some useful events</h3>

Events thrown by Towny can be imported here: import com.palmergames.bukkit.towny.event.<em>EventNameHere</em>
<ul>
PlayerEnterTownEvent - Fired when a player walks into a town.
PlayerLeaveTownEvent - Fired when a player walks out of a town.
NewNationEvent - Fired when a nation is made.
NewTownEvent - Fired when a town is made.
TownClaimEvent - Fired when a townblock is claimed by a town.
TownPreClaimEvent - Fired before a townblock is claimed by a town, can be cancelled.
</ul>
<a href="https://github.com/TownyAdvanced/Towny/tree/master/src/com/palmergames/bukkit/towny/event">For a full list of Events check out the github.</a>

<h3>Of use to Shop Plugin developers:</h3>
<ul>
<li>Our <a href="https://github.com/TownyAdvanced/Towny/blob/master/src/com/palmergames/bukkit/towny/utils/ShopPlotUtil.java">ShopPlotUtil</a> provides easy-to-use tests to query if a player can make a shop at a location.</li></ul>

<h3>Example plugins using the TownyAPI:</h3>
<ul>
<li><a href="https://github.com/TownyAdvanced/TownyFlight">TownyFlight</a></li>
</ul>